- name: Deploy ServerLedge
  hosts: all
  user: giacomo

  tasks:
      - name: Create the repo directory if it doesn't exist
        file:
          path: ~/serverledge-deploy
          state: directory
          mode: '0755'
      - name: Create the bin directory if it doesn't exist
        file:
          path: ~/serverledge-deploy/serverledge-bin
          state: directory
          mode: '0755'
      - name: Update the local git repository
        git:
          repo: https://github.com/grussorusso/serverledge-deploy.git
          dest: ~/serverledge-deploy
          version: pmc23
          clone: yes
      - name: Copy the bin folder
        copy:
          src: ../../bin/
          dest: ~/serverledge-deploy/serverledge-bin/
          mode: "0755"
#      - name: Copy the serverledge binary to the remote directory
#        copy:
#          src: ../../bin/serverledge
#          dest: ~/serverledge-deploy/serverledge-bin
#          mode: '0777'
#      - name: Copy the serverledge-cli binary to the remote directory
#        copy:
#          src: ../../bin/serverledge-cli
#          dest: ~/serverledge-deploy/serverledge-bin
#          mode: '0777'
#      - name: Copy the serverledge-cli binary to the remote directory
#        copy:
#          src: ../../bin/serverledge-cli
#          dest: ~/serverledge-deploy/serverledge-bin
#          mode: '0777'
      - name: Create the inventory directory if it doesn't exist
        file:
          path: ~/serverledge-deploy/inventory
          state: directory
          mode: '0755'
      - name: Create inventory.ini file
        copy:
          content: |
            [sedge_Edge]
            192.168.122.27
            192.168.122.70
  
            [sedge_Cloud]
            192.168.122.167
          dest: ~/serverledge-deploy/inventory/inventory.ini
          mode: '0644'
      - name: Deploy serverledge
        command: ansible-playbook ~/serverledge-deploy/deploy_serverledge.yml
        environment:
          ANSIBLE_INVENTORY: ~/serverledge-deploy/inventory/inventory.ini